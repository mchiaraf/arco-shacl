@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix a-cd: <https://w3id.org/arco/ontology/context-description/> .
@prefix a-cat: <https://w3id.org/arco/ontology/catalogue/> .
@prefix a-ce: <https://w3id.org/arco/ontology/cultural-event/> .
@prefix a-dd: <https://w3id.org/arco/ontology/denotative-description/> .
@prefix a-lite: <https://w3id.org/arco/ontology/arco-lite/> .
@prefix a-loc: <https://w3id.org/arco/ontology/location/> .
@prefix a-cat: <https://w3id.org/arco/ontology/catalogue/> .
@prefix arco: <https://w3id.org/arco/ontology/arco/> .
@prefix cis: <http://dati.beniculturali.it/cis/> .
@prefix clv: <https://w3id.org/italia/onto/CLV/> .
@prefix core: <https://w3id.org/arco/ontology/core/> .
@prefix cov: <https://w3id.org/italia/onto/COV/> .
@prefix cpv: <https://w3id.org/italia/onto/CPV/> .
@prefix ipac: <https://ipac.cultura.gov.it/onto/ipac/> .
@prefix l0: <https://w3id.org/italia/onto/l0/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix ti: <https://w3id.org/italia/onto/TI/> . 
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix ex: <https://w3id.org/arco/shacl/> .

ex:CatalogueRecordVersionShape
    a sh:NodeShape ;
    sh:targetClass a-cat:CatalogueRecordVersion ;
	sh:property [              
		sh:path a-cat:editedAtTime ;     
		sh:nodeKind sh:IRI ;
		# eventualmente si possono fare restrizioni sulla classe ti:TemporalEntity / ti:TimeInterval
		sh:minCount 1 ;
		sh:maxCount 1 ;
		sh:severity sh:Violation ;
        sh:message "La relazione della versione della scheda catalografica al momento della compilazione con l'anno di compilazione è obbligatoria"
		] ;
	# shape condizionale da anagrafica di base: se core:hasType a-cat:Compiling, deve avere a-lite:hasOfficialInCharge valorizzata
   	sh:or (
	    [
	        sh:property [
	            sh:path core:hasType ;
                sh:hasValue a-cat:Compiling ;
            ] ;
            sh:property [
                sh:path a-lite:hasOfficialInCharge ;
                sh:class l0:Agent ;
                sh:minCount 1 ;
                sh:maxCount 1 ;
                sh:severity sh:Violation ;
                sh:message "Se la scheda è di tipo a-cat:Compiling, deve esserci almeno un agente responsabile"
				# !! dentro agli sh:or spesso severity e message non vengono visualizzati nel validation report !!
            ]
        ]
        [
            sh:property [
                sh:path core:hasType ;
                sh:not [ sh:hasValue a-cat:Compiling ] ;
                # !! non obbligatorietà dell'agente responsabile per le altre tipologie di versioni di scheda (e.g. aggiornamento, revisione, ecc)
            ]
        ]
    ) ;

    sh:property [              
        sh:path core:hasType ;
    ] .